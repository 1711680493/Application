# 内网穿透(NAT穿透)软件 服务端
>Java Version: 14.0.1<br>
>author: [Shendi](tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=1711680493)<br>
>博客: [CSDN](https://blog.csdn.net/qq_41806966)
# 数据格式
>接收格式
>>添加操作<br>
>>>add;ip;端口;服务器端口;协议<br>
>>打开操作<br>
>>>open;id<br>
>>关闭操作<br>
>>>close:id<br>

>返回格式<br>
>>添加操作正确无误:<br>
>>>ok;id;端口或者域名<br>
>>打开隧道的返回数据
>>>ok;内网ip;内网端口;端口/域名;协议
>>操作错误<br>
>>>error;错误信息<br>
# 客户端和服务端通信协议
>数据用 ; 隔开,第一个为类型(可以自己制定更严格的协议,这里只是单纯为了教程)<br>
>一个完整的数据体最后带一个字节,内容为-2,-3(结尾)

>发送给客户端数据格式<br>
>>通知客户端有新用户连接<br>
>>>new;用户标识<br>
>>发送数据给客户端<br>
>>>data;用户标识;数据<br>
>>通知客户端指定用户关闭连接<br>
>>>close;用户标识<br>

>发送给用户数据格式<br>
>>发送数据给用户<br>
>>>data;用户标识;数据
# 运行方式
>启动服务端,然后启动客户端,打开隧道<br>
>>确保内网服务端开启,然后用户连接,ok
# 一些不好的地方
>在服务端有很多地方没有封装协议(比如增开关隧道)<br>
>在读取数据的时候(循环条件),使用的是 input.read != -1<br>
>>也就是说,使用的用户和内网服务端需要在发送数据后使用flush(将数据刷新过去)<br>
>>否则数据会停留在缓冲区.